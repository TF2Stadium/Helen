machine:
  services:
    - postgresql
  environment:
    DATABASE_NAME: "circle_test"
    DATABASE_USERNAME: "ubuntu"
    DATABASE_PASSWORD: ""
dependencies:
  pre:
      - go get gopkg.in/niemeyer/godeb.v1/cmd/godeb
      - godeb install
      - go version
deployment:
  master:
    branch: master
    commands:
      - mkdir binaries
      - cp lobbySettingsData.json binaries/lobbySettingsData.json
      - go build -o binaries/helen-prod *.go
      - rsync -rl -e "ssh -p $SSH_PORT" binaries/* $BACKEND_USER@tf2stadium.com:$BACKEND_DEPLOY_PATH_PROD
      - ssh -p $SSH_PORT $BACKEND_USER@tf2stadium.com $BACKEND_DEPLOY_SCRIPT_PROD
  dev:
    branch: dev
    commands:
      - mkdir binaries
      - cp lobbySettingsData.json binaries/lobbySettingsData.json
      - go build -race -o binaries/helen-dev *.go
      - rsync -rl -e "ssh -p $SSH_PORT" binaries/* $BACKEND_USER@tf2stadium.com:$BACKEND_DEPLOY_PATH_DEV
      - ssh -p $SSH_PORT $BACKEND_USER@tf2stadium.com $BACKEND_DEPLOY_SCRIPT_DEV
