machine:
  services:
    - postgresql
dependencies:
  override:
    - go get github.com/stretchr/testify/assert
test:
  override:
    - rm -rf ~/.go_workspace/src/github.com/TF2Stadium/Helen
    - mv ../Helen ~/.go_workspace/src/github.com/TF2Stadium/Helen
    - cd ~/.go_workspace/src/github.com/TF2Stadium/Helen
    - go get
    - psql -c "CREATE ROLE TESTtf2stadium WITH PASSWORD 'dickbutt';"
    - createdb TESTtf2stadium
    - go test ./...
deployment:
  dev:
    branch: circleci
    commands:
      - mkdir binaries
      - go build -o binaries/helen-dev *.go
      - rsync -rl -e "ssh -p $SSH_PORT" dist/* $BACKEND_USER@tf2stadium.com:$BACKEND_DEPLOY_PATH_DEV
      - ssh -p $SSH_PORT $BACKEND_USER@tf2stadium.com $BACKEND_DEPLOY_SCRIPT_DEV
