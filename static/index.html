<!-- Copyright (C) 2015  TF2Stadium -->
<!-- Use of this source code is governed by the GPLv3 -->
<!-- that can be found in the COPYING file. -->

<html>
	<head>
		<script src="http://localhost:3000/bower_components/wsevent.js/wsevent.js"></script>
		<script src="http://localhost:3000/bower_components/asmcrypto/asmcrypto.js"></script>
		<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
		<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet"/>
		
		<script>

var createBox = function(so, messageName, messageFields) {
	html = "<div class=\"messageBox\"><h4>"+messageName+"</h4>";
	messageFields.forEach(function(field) {
		var id = messageName + "_" + field;
		html += "<div class=\"inputField\"><span>" + field + "</span><input type='text' id='" + id + "'></div>"
	});
	html += "<a href='#' id='submit_"+messageName+"'>Submit</a></div>";
	
	$("#message-tests").append(html);
	
	$("#submit_"+messageName).click(function() {
		params = {};
		messageFields.forEach(function(field) {
			var val = $("#"+messageName+"_"+field).val();
			if((field.toLowerCase() !== "steamid" && field.endsWith("id")) || field == "room" || field == "whitelistID" || field == "role") {
				val = parseInt(val);
			} else if (field == "mumbleRequired" || field == "ban") {
				val = (val == "true")
			}
			params[field] = val;
		});
		params["request"] = messageName
		console.log("sent"+JSON.stringify(params))
		so.Emit(params, function(response) {
			if(response != null) {
				console.log("Response to "+messageName+":");
				console.log(JSON.parse(response));
			}
		})
	});
}

var getCookie = function C(k){return(document.cookie.match('(^|; )'+k+'=([^;]*)')||0)[2]}

var url = 'ws://' + window.location.hostname + ':' + window.location.port + '/websocket/';

var so = new Socket(url, {
	extractor: function(obj) {
	return obj["request"]
}})

so.On("asdf", function() {
console.log("asdf received");
})

function sendAuthTest() {
so.Emit({request: "authenticationTest"}, function(s){
alert(JSON.parse(s))
})
}


function consoleLog(text) {
	$("#console").append($("<span>").text(text));
}
function soOnFunc(what, other) {
	so.On(what, function(s) {
		consoleLog("Received " + what);
		consoleLog(JSON.stringify(s));
		if(other) other(s);
	});
}

soOnFunc("chatReceive");
soOnFunc("lobbyData");
soOnFunc("lobbyReadyUp");
soOnFunc("lobbyStart");
soOnFunc("playerSettings")
soOnFunc("playerProfile")
soOnFunc("socketInitialized")
soOnFunc("sendNotification", function(s) {
	toastr.info(s);
});
soOnFunc("lobbyListData", function(s) {
	$("#lobby-list").html(JSON.stringify(s, null, 2).replace(/(\r)?\n/g, "<br>"));
});

$(function() {
	createBox(so, "lobbyCreate", ["map", "type", "league", "whitelistID", "server", "rconpwd", "mumbleRequired"]);
	createBox(so, "serverVerify", ["server", "rconpwd"]);
	createBox(so, "lobbyClose", ["id"]);
	createBox(so, "lobbyJoin", ["id", "team", "class"]);
	createBox(so, "debugLobbyFill", ["id"]);
	createBox(so, "debugLobbyReady", ["id"]);
	createBox(so, "lobbySpectatorJoin", ["id"]);
	createBox(so, "lobbyKick", ["id", "steamid", "ban"]);
	createBox(so, "playerReady", []);
	createBox(so, "playerNotReady", []);
	createBox(so, "chatSend", ["message", "room"]);
	createBox(so, "playerSettingsSet", ["key", "value"]);
	createBox(so, "playerSettingsGet", ["key"]);
	createBox(so, "playerProfile", ["steamid"]);
	createBox(so, "adminChangeRole", ["steamid", "role"]);
	createBox(so, "requestLobbyListData", []);
	createBox(so, "getConstant", ["constant"]);
	createBox(so, "debugGetAllLobbies", []);
	createBox(so, "debugRequestLobbyStart", ["id"]);
	createBox(so, "debugUpdateStatsFilter", ["id"]); 
});
		</script>
		<style>
* { box-sizing: border-box; }
body { padding: 0; margin: 0; background-color: #222; color: #f0f0f0; font-family: sans-serif; }
a { color: #ccf; }
#box1 { height: 100%; padding-top: 40px; }
pre { margin: 0; }
#box1>div>h3 { margin: 0; text-align: center; position: absolute; top: 0; width: 100%; line-height: 30px; }
#box1top { height: 40px; line-height: 30px; padding: 5px; position: absolute; top: 0; left: 0; right: 0; background-color: #333; }
#message-tests-container { width: 50%; float: left; height: 100%; padding-top: 30px; position: relative; }
#lobby-list-container { width: 50%; float: left; height: 100%; padding-top: 30px; position: relative; }
#message-tests { width: 100%; height: 100%; padding: 5px; overflow-y: scroll; }
#lobby-list { width: 100%; height: 100%; padding: 5px; overflow-y: scroll; border-right: 1px solid transparent; }
.messageBox { padding-bottom: 5px; border-bottom: 1px solid #ccc; margin-bottom: 5px; }
.messageBox h4 { margin: 0; }
.messageBox a { display: block; }
.inputField { width: 50%; display: inline-block; padding: 3px; }
.inputField span, .inputField input { display: inline-block; width: 50%;}
.inputField span { text-align: right; padding-right: 20px; }
#box2 { height: 40%; overflow-y: scroll; background-color: #333; padding: 5px; }
#console { width: 100%; word-wrap: break-word; }
		</style>
	</head>
	<body style="position: relative">
		<div id="box1">
			<div id="box1top">
				<button onclick="sendAuthTest()">Test authentication</button>
				<a href="/startLogin">Login</a>
				<a href="/logout">Logout</a>
			</div>
			
			<div id="message-tests-container">
				<h3>Message Tests</h3>
				<div id="message-tests"></div>
			</div>
			<div id="lobby-list-container">
				<h3>Lobby List</h3>
				<pre id="lobby-list"></pre>
			</div>
		</div>
		<div id="box2" style="display: none;">
			<pre id="console"></pre>
		</div>
	</body>
</html>
